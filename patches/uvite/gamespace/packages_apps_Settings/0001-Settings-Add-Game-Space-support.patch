From 89110b19cc645c511c594d3caefc9290ba32eada Mon Sep 17 00:00:00 2001
From: Nauval Rizky <enuma.alrizky@gmail.com>
Date: Sun, 28 Aug 2022 11:28:10 +0000
Subject: [PATCH] Settings: Add Game Space support

Co-authored-by: alanndz <alanndz7@gmail.com>
Change-Id: Ic2cc28a77188b646dbd54f8151b3a18a8279ac05
Signed-off-by: Gustavo Mendes <gusttavo.me@outlook.com>
---
 res/values/aospa_strings.xml                  |  4 ++
 res/xml/apps.xml                              |  8 +++
 .../applications/GameSpaceController.java     | 67 +++++++++++++++++++
 3 files changed, 79 insertions(+)
 create mode 100644 src/com/android/settings/applications/GameSpaceController.java

diff --git a/res/values/aospa_strings.xml b/res/values/aospa_strings.xml
index 1dea0f15894..39712703f88 100644
--- a/res/values/aospa_strings.xml
+++ b/res/values/aospa_strings.xml
@@ -15,6 +15,10 @@
 -->
 <resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
 
+    <!-- Game Space -->
+    <string name="game_space_title">Game Space</string>
+    <string name="game_space_summary">Enhance your gaming experience</string>
+
     <!-- Android debugging as root -->
     <string name="adb_enable_root">Rooted debugging</string>
     <string name="adb_enable_summary_root">Allow running Android debugging as root</string>
diff --git a/res/xml/apps.xml b/res/xml/apps.xml
index 7b9edd3a999..816e810b817 100644
--- a/res/xml/apps.xml
+++ b/res/xml/apps.xml
@@ -80,6 +80,14 @@
         <intent android:action="android.settings.MANAGE_CLONED_APPS_SETTINGS"/>
     </Preference>
 
+    <Preference
+        android:key="game_settings"
+        android:title="@string/game_space_title"
+        android:summary="@string/game_space_summary"
+        android:order="-994"
+        settings:controller="com.android.settings.applications.GameSpaceController">
+    </Preference>
+
     <PreferenceCategory
         android:key="dashboard_tile_placeholder"
         android:order="10"/>
diff --git a/src/com/android/settings/applications/GameSpaceController.java b/src/com/android/settings/applications/GameSpaceController.java
new file mode 100644
index 00000000000..ca442f4757f
--- /dev/null
+++ b/src/com/android/settings/applications/GameSpaceController.java
@@ -0,0 +1,67 @@
+/*
+ * Copyright (C) 2021 The Android Open Source Project
+ * Copyright (C) 2022 Bianca Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.android.settings.applications;
+
+import android.content.Context;
+import android.content.pm.PackageManager;
+import android.content.Intent;
+import android.content.ComponentName;
+import android.os.UserHandle;
+import android.text.TextUtils;
+
+import androidx.preference.Preference;
+
+import com.android.settings.core.BasePreferenceController;
+
+public class GameSpaceController extends BasePreferenceController {
+
+    private static final String GAME_PACKAGE = "io.chaldeaprjkt.gamespace";
+    private static final String GAME_SETTINGS = "io.chaldeaprjkt.gamespace.settings.SettingsActivity";
+
+    private final PackageManager mPackageManager;
+
+    public GameSpaceController(Context context, String preferenceKey) {
+        super(context, preferenceKey);
+        mPackageManager = mContext.getPackageManager();
+    }
+
+    private Intent settingsIntent() {
+        Intent intent = new Intent();
+        ComponentName component = new ComponentName(GAME_PACKAGE, GAME_SETTINGS);
+        intent.setComponent(component);
+        return intent;
+    }
+
+    @Override
+    public int getAvailabilityStatus() {
+        return mContext.getPackageManager().resolveActivity(settingsIntent(), 0) != null
+                ? AVAILABLE : UNSUPPORTED_ON_DEVICE;
+    }
+
+    @Override
+    public boolean handlePreferenceTreeClick(Preference preference) {
+        if (!TextUtils.equals(preference.getKey(), getPreferenceKey())) {
+            return false;
+        }
+
+        Intent intent = settingsIntent();
+        intent.putExtra("referer", this.getClass().getCanonicalName());
+        mContext.startActivityAsUser(intent, UserHandle.CURRENT);
+        return true;
+    }
+}
-- 
2.43.0

